{"version":3,"file":"TransactionBuilder.mjs","sources":["../../src/TransactionBuilder.ts"],"sourcesContent":["import { SolAmount } from './Amount';\nimport type { Context } from './Context';\nimport { SdkError } from './errors';\nimport type {\n  AccountMeta,\n  Instruction,\n  WrappedInstruction,\n} from './Instruction';\nimport type {\n  RpcConfirmTransactionOptions,\n  RpcConfirmTransactionResult,\n  RpcConfirmTransactionStrategy,\n  RpcGetLatestBlockhashOptions,\n  RpcSendTransactionOptions,\n} from './RpcInterface';\nimport { Signer, signTransaction, uniqueSigners } from './Signer';\nimport {\n  AddressLookupTableInput,\n  Blockhash,\n  BlockhashWithExpiryBlockHeight,\n  Transaction,\n  TransactionInput,\n  TransactionSignature,\n  TransactionVersion,\n  TRANSACTION_SIZE_LIMIT,\n} from './Transaction';\n\n/**\n * Defines an generic object with wrapped instructions,\n * such as a {@link TransactionBuilder}.\n * @category Transactions\n */\nexport type HasWrappedInstructions = { items: WrappedInstruction[] };\n\n/**\n * Defines all the possible inputs for adding items to a transaction builder.\n * @category Transactions\n */\nexport type TransactionBuilderItemsInput =\n  | WrappedInstruction\n  | WrappedInstruction[]\n  | HasWrappedInstructions\n  | HasWrappedInstructions[];\n\n/**\n * The available options of a transaction builder.\n * @category Transactions\n */\nexport type TransactionBuilderOptions = {\n  /** The signer paying for the transaction fee. */\n  feePayer?: Signer;\n  /** The version of the transaction to build. */\n  version?: TransactionVersion;\n  /** The address lookup tables to attach to the built transaction. */\n  addressLookupTables?: AddressLookupTableInput[];\n  /** The blockhash that should be associated with the built transaction. */\n  blockhash?: Blockhash | BlockhashWithExpiryBlockHeight;\n};\n\n/**\n * A set of options to use when sending and confirming\n * a transaction directly from a transaction builder.\n * @category Transactions\n */\nexport type TransactionBuilderSendAndConfirmOptions = {\n  send?: RpcSendTransactionOptions;\n  confirm?: Partial<RpcConfirmTransactionOptions>;\n};\n\n/**\n * A builder that helps construct transactions.\n * @category Transactions\n */\nexport class TransactionBuilder implements HasWrappedInstructions {\n  constructor(\n    readonly items: WrappedInstruction[] = [],\n    readonly options: TransactionBuilderOptions = {}\n  ) {}\n\n  empty(): TransactionBuilder {\n    return new TransactionBuilder([], this.options);\n  }\n\n  setItems(input: TransactionBuilderItemsInput): TransactionBuilder {\n    return new TransactionBuilder(this.parseItems(input), this.options);\n  }\n\n  prepend(input: TransactionBuilderItemsInput): TransactionBuilder {\n    return new TransactionBuilder(\n      [...this.parseItems(input), ...this.items],\n      this.options\n    );\n  }\n\n  append(input: TransactionBuilderItemsInput): TransactionBuilder {\n    return new TransactionBuilder(\n      [...this.items, ...this.parseItems(input)],\n      this.options\n    );\n  }\n\n  add(input: TransactionBuilderItemsInput): TransactionBuilder {\n    return this.append(input);\n  }\n\n  mapInstructions(\n    fn: (\n      wrappedInstruction: WrappedInstruction,\n      index: number,\n      array: WrappedInstruction[]\n    ) => WrappedInstruction\n  ): TransactionBuilder {\n    return new TransactionBuilder(this.items.map(fn), this.options);\n  }\n\n  addRemainingAccounts(\n    accountMeta: AccountMeta | AccountMeta[],\n    instructionIndex?: number\n  ): TransactionBuilder {\n    instructionIndex = instructionIndex ?? this.items.length - 1;\n    return this.mapInstructions((wrappedInstruction, index) => {\n      if (index !== instructionIndex) return wrappedInstruction;\n      const keys = [\n        ...wrappedInstruction.instruction.keys,\n        ...(Array.isArray(accountMeta) ? accountMeta : [accountMeta]),\n      ];\n      return {\n        ...wrappedInstruction,\n        instruction: { ...wrappedInstruction.instruction, keys },\n      };\n    });\n  }\n\n  splitByIndex(index: number): [TransactionBuilder, TransactionBuilder] {\n    return [\n      new TransactionBuilder(this.items.slice(0, index), this.options),\n      new TransactionBuilder(this.items.slice(index), this.options),\n    ];\n  }\n\n  /**\n   * Split the builder into multiple builders, such that\n   * each of them should fit in a single transaction.\n   *\n   * This method is unsafe for several reasons:\n   * - Because transactions are atomic, splitting the builder\n   *   into multiple transactions may cause undesired side effects.\n   *   For example, if the first transaction succeeds but the second\n   *   one fails, you may end up with an inconsistent account state.\n   *   This is why it is recommended to manually split your transactions\n   *   such that each of them is valid on its own.\n   * - It can only split the instructions of the builder. Meaning that,\n   *   if the builder has a single instruction that is too big to fit in\n   *   a single transaction, it will not be able to split it.\n   */\n  unsafeSplitByTransactionSize(\n    context: Pick<Context, 'transactions' | 'payer'>\n  ): TransactionBuilder[] {\n    return this.items.reduce(\n      (builders, item) => {\n        const lastBuilder = builders.pop() as TransactionBuilder;\n        const lastBuilderWithItem = lastBuilder.add(item);\n        if (lastBuilderWithItem.fitsInOneTransaction(context)) {\n          builders.push(lastBuilderWithItem);\n        } else {\n          builders.push(lastBuilder);\n          builders.push(lastBuilder.empty().add(item));\n        }\n        return builders;\n      },\n      [this.empty()]\n    );\n  }\n\n  setFeePayer(feePayer: Signer): TransactionBuilder {\n    return new TransactionBuilder(this.items, { ...this.options, feePayer });\n  }\n\n  getFeePayer(context: Pick<Context, 'payer'>): Signer {\n    return this.options.feePayer ?? context.payer;\n  }\n\n  setVersion(version: TransactionVersion): TransactionBuilder {\n    return new TransactionBuilder(this.items, { ...this.options, version });\n  }\n\n  useLegacyVersion(): TransactionBuilder {\n    return this.setVersion('legacy');\n  }\n\n  useV0(): TransactionBuilder {\n    return this.setVersion(0);\n  }\n\n  setAddressLookupTables(\n    addressLookupTables: AddressLookupTableInput[]\n  ): TransactionBuilder {\n    return new TransactionBuilder(this.items, {\n      ...this.options,\n      addressLookupTables,\n    });\n  }\n\n  getBlockhash(): Blockhash | undefined {\n    return typeof this.options.blockhash === 'object'\n      ? this.options.blockhash.blockhash\n      : this.options.blockhash;\n  }\n\n  setBlockhash(\n    blockhash: Blockhash | BlockhashWithExpiryBlockHeight\n  ): TransactionBuilder {\n    return new TransactionBuilder(this.items, { ...this.options, blockhash });\n  }\n\n  async setLatestBlockhash(\n    context: Pick<Context, 'rpc'>,\n    options: RpcGetLatestBlockhashOptions = {}\n  ): Promise<TransactionBuilder> {\n    return this.setBlockhash(await context.rpc.getLatestBlockhash(options));\n  }\n\n  getInstructions(): Instruction[] {\n    return this.items.map((item) => item.instruction);\n  }\n\n  getSigners(context: Pick<Context, 'payer'>): Signer[] {\n    return uniqueSigners([\n      this.getFeePayer(context),\n      ...this.items.flatMap((item) => item.signers),\n    ]);\n  }\n\n  getBytesCreatedOnChain(): number {\n    return this.items.reduce((sum, item) => sum + item.bytesCreatedOnChain, 0);\n  }\n\n  async getRentCreatedOnChain(\n    context: Pick<Context, 'rpc'>\n  ): Promise<SolAmount> {\n    return context.rpc.getRent(this.getBytesCreatedOnChain(), {\n      includesHeaderBytes: true,\n    });\n  }\n\n  getTransactionSize(context: Pick<Context, 'transactions' | 'payer'>): number {\n    return context.transactions.serialize(\n      this.setBlockhash('11111111111111111111111111111111').build(context)\n    ).length;\n  }\n\n  minimumTransactionsRequired(\n    context: Pick<Context, 'transactions' | 'payer'>\n  ): number {\n    return Math.ceil(this.getTransactionSize(context) / TRANSACTION_SIZE_LIMIT);\n  }\n\n  fitsInOneTransaction(\n    context: Pick<Context, 'transactions' | 'payer'>\n  ): boolean {\n    return this.minimumTransactionsRequired(context) === 1;\n  }\n\n  build(context: Pick<Context, 'transactions' | 'payer'>): Transaction {\n    const blockhash = this.getBlockhash();\n    if (!blockhash) {\n      throw new SdkError(\n        'Setting a blockhash is required to build a transaction. ' +\n          'Please use the `setBlockhash` or `setLatestBlockhash` methods.'\n      );\n    }\n    const input: TransactionInput = {\n      version: this.options.version ?? 0,\n      payer: this.getFeePayer(context).publicKey,\n      instructions: this.getInstructions(),\n      blockhash,\n    };\n    if (input.version === 0 && this.options.addressLookupTables) {\n      input.addressLookupTables = this.options.addressLookupTables;\n    }\n    return context.transactions.create(input);\n  }\n\n  async buildWithLatestBlockhash(\n    context: Pick<Context, 'transactions' | 'rpc' | 'payer'>,\n    options: RpcGetLatestBlockhashOptions = {}\n  ): Promise<Transaction> {\n    let builder: TransactionBuilder = this;\n    if (!this.options.blockhash) {\n      builder = await this.setLatestBlockhash(context, options);\n    }\n    return builder.build(context);\n  }\n\n  async buildAndSign(\n    context: Pick<Context, 'transactions' | 'rpc' | 'payer'>\n  ): Promise<Transaction> {\n    return signTransaction(\n      await this.buildWithLatestBlockhash(context),\n      this.getSigners(context)\n    );\n  }\n\n  async send(\n    context: Pick<Context, 'transactions' | 'rpc' | 'payer'>,\n    options: RpcSendTransactionOptions = {}\n  ): Promise<TransactionSignature> {\n    const transaction = await this.buildAndSign(context);\n    return context.rpc.sendTransaction(transaction, options);\n  }\n\n  async confirm(\n    context: Pick<Context, 'transactions' | 'rpc' | 'payer'>,\n    signature: TransactionSignature,\n    options: Partial<RpcConfirmTransactionOptions> = {}\n  ): Promise<RpcConfirmTransactionResult> {\n    let builder: TransactionBuilder = this;\n    if (!this.options.blockhash) {\n      builder = await this.setLatestBlockhash(context);\n    }\n\n    let strategy: RpcConfirmTransactionStrategy;\n    if (options.strategy) {\n      strategy = options.strategy;\n    } else {\n      const blockhash =\n        typeof builder.options.blockhash === 'object'\n          ? builder.options.blockhash\n          : await context.rpc.getLatestBlockhash();\n      strategy = options.strategy ?? { type: 'blockhash', ...blockhash };\n    }\n\n    return context.rpc.confirmTransaction(signature, { ...options, strategy });\n  }\n\n  async sendAndConfirm(\n    context: Pick<Context, 'transactions' | 'rpc' | 'payer'>,\n    options: TransactionBuilderSendAndConfirmOptions = {}\n  ): Promise<{\n    signature: TransactionSignature;\n    result: RpcConfirmTransactionResult;\n  }> {\n    let builder: TransactionBuilder = this;\n    if (!this.options.blockhash) {\n      builder = await this.setLatestBlockhash(context);\n    }\n    const signature = await builder.send(context, options.send);\n    const result = await builder.confirm(context, signature, options.confirm);\n    return { signature, result };\n  }\n\n  protected parseItems(\n    input: TransactionBuilderItemsInput\n  ): WrappedInstruction[] {\n    return (Array.isArray(input) ? input : [input]).flatMap((item) =>\n      'items' in item ? item.items : [item]\n    );\n  }\n}\n\n/**\n * Creates a new transaction builder.\n * @category Transactions\n */\nexport const transactionBuilder = (items: WrappedInstruction[] = []) =>\n  new TransactionBuilder(items);\n"],"names":["TransactionBuilder","constructor","items","options","empty","setItems","input","parseItems","prepend","append","add","mapInstructions","fn","map","addRemainingAccounts","accountMeta","instructionIndex","length","wrappedInstruction","index","keys","instruction","Array","isArray","splitByIndex","slice","unsafeSplitByTransactionSize","context","reduce","builders","item","lastBuilder","pop","lastBuilderWithItem","fitsInOneTransaction","push","setFeePayer","feePayer","getFeePayer","payer","setVersion","version","useLegacyVersion","useV0","setAddressLookupTables","addressLookupTables","getBlockhash","blockhash","setBlockhash","setLatestBlockhash","rpc","getLatestBlockhash","getInstructions","getSigners","uniqueSigners","flatMap","signers","getBytesCreatedOnChain","sum","bytesCreatedOnChain","getRentCreatedOnChain","getRent","includesHeaderBytes","getTransactionSize","transactions","serialize","build","minimumTransactionsRequired","Math","ceil","TRANSACTION_SIZE_LIMIT","SdkError","publicKey","instructions","create","buildWithLatestBlockhash","builder","buildAndSign","signTransaction","send","transaction","sendTransaction","confirm","signature","strategy","type","confirmTransaction","sendAndConfirm","result","transactionBuilder"],"mappings":";;;;AA2BA;AACA;AACA;AACA;AACA;;AAsCA;AACA;AACA;AACA;AACO,MAAMA,kBAAkB,CAAmC;EAChEC,WAAW,CACAC,KAA2B,GAAG,EAAE,EAChCC,OAAkC,GAAG,EAAE,EAChD;IAAA,IAFSD,CAAAA,KAA2B,GAA3BA,KAA2B,CAAA;IAAA,IAC3BC,CAAAA,OAAkC,GAAlCA,OAAkC,CAAA;AAC1C,GAAA;AAEHC,EAAAA,KAAK,GAAuB;IAC1B,OAAO,IAAIJ,kBAAkB,CAAC,EAAE,EAAE,IAAI,CAACG,OAAO,CAAC,CAAA;AACjD,GAAA;EAEAE,QAAQ,CAACC,KAAmC,EAAsB;AAChE,IAAA,OAAO,IAAIN,kBAAkB,CAAC,IAAI,CAACO,UAAU,CAACD,KAAK,CAAC,EAAE,IAAI,CAACH,OAAO,CAAC,CAAA;AACrE,GAAA;EAEAK,OAAO,CAACF,KAAmC,EAAsB;IAC/D,OAAO,IAAIN,kBAAkB,CAC3B,CAAC,GAAG,IAAI,CAACO,UAAU,CAACD,KAAK,CAAC,EAAE,GAAG,IAAI,CAACJ,KAAK,CAAC,EAC1C,IAAI,CAACC,OAAO,CACb,CAAA;AACH,GAAA;EAEAM,MAAM,CAACH,KAAmC,EAAsB;IAC9D,OAAO,IAAIN,kBAAkB,CAC3B,CAAC,GAAG,IAAI,CAACE,KAAK,EAAE,GAAG,IAAI,CAACK,UAAU,CAACD,KAAK,CAAC,CAAC,EAC1C,IAAI,CAACH,OAAO,CACb,CAAA;AACH,GAAA;EAEAO,GAAG,CAACJ,KAAmC,EAAsB;AAC3D,IAAA,OAAO,IAAI,CAACG,MAAM,CAACH,KAAK,CAAC,CAAA;AAC3B,GAAA;EAEAK,eAAe,CACbC,EAIuB,EACH;AACpB,IAAA,OAAO,IAAIZ,kBAAkB,CAAC,IAAI,CAACE,KAAK,CAACW,GAAG,CAACD,EAAE,CAAC,EAAE,IAAI,CAACT,OAAO,CAAC,CAAA;AACjE,GAAA;AAEAW,EAAAA,oBAAoB,CAClBC,WAAwC,EACxCC,gBAAyB,EACL;IACpBA,gBAAgB,GAAGA,gBAAgB,IAAI,IAAI,CAACd,KAAK,CAACe,MAAM,GAAG,CAAC,CAAA;IAC5D,OAAO,IAAI,CAACN,eAAe,CAAC,CAACO,kBAAkB,EAAEC,KAAK,KAAK;AACzD,MAAA,IAAIA,KAAK,KAAKH,gBAAgB,EAAE,OAAOE,kBAAkB,CAAA;MACzD,MAAME,IAAI,GAAG,CACX,GAAGF,kBAAkB,CAACG,WAAW,CAACD,IAAI,EACtC,IAAIE,KAAK,CAACC,OAAO,CAACR,WAAW,CAAC,GAAGA,WAAW,GAAG,CAACA,WAAW,CAAC,CAAC,CAC9D,CAAA;MACD,OAAO;AACL,QAAA,GAAGG,kBAAkB;AACrBG,QAAAA,WAAW,EAAE;UAAE,GAAGH,kBAAkB,CAACG,WAAW;AAAED,UAAAA,IAAAA;AAAK,SAAA;OACxD,CAAA;AACH,KAAC,CAAC,CAAA;AACJ,GAAA;EAEAI,YAAY,CAACL,KAAa,EAA4C;AACpE,IAAA,OAAO,CACL,IAAInB,kBAAkB,CAAC,IAAI,CAACE,KAAK,CAACuB,KAAK,CAAC,CAAC,EAAEN,KAAK,CAAC,EAAE,IAAI,CAAChB,OAAO,CAAC,EAChE,IAAIH,kBAAkB,CAAC,IAAI,CAACE,KAAK,CAACuB,KAAK,CAACN,KAAK,CAAC,EAAE,IAAI,CAAChB,OAAO,CAAC,CAC9D,CAAA;AACH,GAAA;;AAEA;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;EACEuB,4BAA4B,CAC1BC,OAAgD,EAC1B;IACtB,OAAO,IAAI,CAACzB,KAAK,CAAC0B,MAAM,CACtB,CAACC,QAAQ,EAAEC,IAAI,KAAK;AAClB,MAAA,MAAMC,WAAW,GAAGF,QAAQ,CAACG,GAAG,EAAwB,CAAA;AACxD,MAAA,MAAMC,mBAAmB,GAAGF,WAAW,CAACrB,GAAG,CAACoB,IAAI,CAAC,CAAA;AACjD,MAAA,IAAIG,mBAAmB,CAACC,oBAAoB,CAACP,OAAO,CAAC,EAAE;AACrDE,QAAAA,QAAQ,CAACM,IAAI,CAACF,mBAAmB,CAAC,CAAA;AACpC,OAAC,MAAM;AACLJ,QAAAA,QAAQ,CAACM,IAAI,CAACJ,WAAW,CAAC,CAAA;AAC1BF,QAAAA,QAAQ,CAACM,IAAI,CAACJ,WAAW,CAAC3B,KAAK,EAAE,CAACM,GAAG,CAACoB,IAAI,CAAC,CAAC,CAAA;AAC9C,OAAA;AACA,MAAA,OAAOD,QAAQ,CAAA;AACjB,KAAC,EACD,CAAC,IAAI,CAACzB,KAAK,EAAE,CAAC,CACf,CAAA;AACH,GAAA;EAEAgC,WAAW,CAACC,QAAgB,EAAsB;AAChD,IAAA,OAAO,IAAIrC,kBAAkB,CAAC,IAAI,CAACE,KAAK,EAAE;MAAE,GAAG,IAAI,CAACC,OAAO;AAAEkC,MAAAA,QAAAA;AAAS,KAAC,CAAC,CAAA;AAC1E,GAAA;EAEAC,WAAW,CAACX,OAA+B,EAAU;IACnD,OAAO,IAAI,CAACxB,OAAO,CAACkC,QAAQ,IAAIV,OAAO,CAACY,KAAK,CAAA;AAC/C,GAAA;EAEAC,UAAU,CAACC,OAA2B,EAAsB;AAC1D,IAAA,OAAO,IAAIzC,kBAAkB,CAAC,IAAI,CAACE,KAAK,EAAE;MAAE,GAAG,IAAI,CAACC,OAAO;AAAEsC,MAAAA,OAAAA;AAAQ,KAAC,CAAC,CAAA;AACzE,GAAA;AAEAC,EAAAA,gBAAgB,GAAuB;AACrC,IAAA,OAAO,IAAI,CAACF,UAAU,CAAC,QAAQ,CAAC,CAAA;AAClC,GAAA;AAEAG,EAAAA,KAAK,GAAuB;AAC1B,IAAA,OAAO,IAAI,CAACH,UAAU,CAAC,CAAC,CAAC,CAAA;AAC3B,GAAA;EAEAI,sBAAsB,CACpBC,mBAA8C,EAC1B;AACpB,IAAA,OAAO,IAAI7C,kBAAkB,CAAC,IAAI,CAACE,KAAK,EAAE;MACxC,GAAG,IAAI,CAACC,OAAO;AACf0C,MAAAA,mBAAAA;AACF,KAAC,CAAC,CAAA;AACJ,GAAA;AAEAC,EAAAA,YAAY,GAA0B;IACpC,OAAO,OAAO,IAAI,CAAC3C,OAAO,CAAC4C,SAAS,KAAK,QAAQ,GAC7C,IAAI,CAAC5C,OAAO,CAAC4C,SAAS,CAACA,SAAS,GAChC,IAAI,CAAC5C,OAAO,CAAC4C,SAAS,CAAA;AAC5B,GAAA;EAEAC,YAAY,CACVD,SAAqD,EACjC;AACpB,IAAA,OAAO,IAAI/C,kBAAkB,CAAC,IAAI,CAACE,KAAK,EAAE;MAAE,GAAG,IAAI,CAACC,OAAO;AAAE4C,MAAAA,SAAAA;AAAU,KAAC,CAAC,CAAA;AAC3E,GAAA;EAEA,MAAME,kBAAkB,CACtBtB,OAA6B,EAC7BxB,OAAqC,GAAG,EAAE,EACb;AAC7B,IAAA,OAAO,IAAI,CAAC6C,YAAY,CAAC,MAAMrB,OAAO,CAACuB,GAAG,CAACC,kBAAkB,CAAChD,OAAO,CAAC,CAAC,CAAA;AACzE,GAAA;AAEAiD,EAAAA,eAAe,GAAkB;IAC/B,OAAO,IAAI,CAAClD,KAAK,CAACW,GAAG,CAAEiB,IAAI,IAAKA,IAAI,CAACT,WAAW,CAAC,CAAA;AACnD,GAAA;EAEAgC,UAAU,CAAC1B,OAA+B,EAAY;IACpD,OAAO2B,aAAa,CAAC,CACnB,IAAI,CAAChB,WAAW,CAACX,OAAO,CAAC,EACzB,GAAG,IAAI,CAACzB,KAAK,CAACqD,OAAO,CAAEzB,IAAI,IAAKA,IAAI,CAAC0B,OAAO,CAAC,CAC9C,CAAC,CAAA;AACJ,GAAA;AAEAC,EAAAA,sBAAsB,GAAW;AAC/B,IAAA,OAAO,IAAI,CAACvD,KAAK,CAAC0B,MAAM,CAAC,CAAC8B,GAAG,EAAE5B,IAAI,KAAK4B,GAAG,GAAG5B,IAAI,CAAC6B,mBAAmB,EAAE,CAAC,CAAC,CAAA;AAC5E,GAAA;EAEA,MAAMC,qBAAqB,CACzBjC,OAA6B,EACT;IACpB,OAAOA,OAAO,CAACuB,GAAG,CAACW,OAAO,CAAC,IAAI,CAACJ,sBAAsB,EAAE,EAAE;AACxDK,MAAAA,mBAAmB,EAAE,IAAA;AACvB,KAAC,CAAC,CAAA;AACJ,GAAA;EAEAC,kBAAkB,CAACpC,OAAgD,EAAU;AAC3E,IAAA,OAAOA,OAAO,CAACqC,YAAY,CAACC,SAAS,CACnC,IAAI,CAACjB,YAAY,CAAC,kCAAkC,CAAC,CAACkB,KAAK,CAACvC,OAAO,CAAC,CACrE,CAACV,MAAM,CAAA;AACV,GAAA;EAEAkD,2BAA2B,CACzBxC,OAAgD,EACxC;AACR,IAAA,OAAOyC,IAAI,CAACC,IAAI,CAAC,IAAI,CAACN,kBAAkB,CAACpC,OAAO,CAAC,GAAG2C,sBAAsB,CAAC,CAAA;AAC7E,GAAA;EAEApC,oBAAoB,CAClBP,OAAgD,EACvC;AACT,IAAA,OAAO,IAAI,CAACwC,2BAA2B,CAACxC,OAAO,CAAC,KAAK,CAAC,CAAA;AACxD,GAAA;EAEAuC,KAAK,CAACvC,OAAgD,EAAe;AACnE,IAAA,MAAMoB,SAAS,GAAG,IAAI,CAACD,YAAY,EAAE,CAAA;IACrC,IAAI,CAACC,SAAS,EAAE;AACd,MAAA,MAAM,IAAIwB,QAAQ,CAChB,0DAA0D,GACxD,gEAAgE,CACnE,CAAA;AACH,KAAA;AACA,IAAA,MAAMjE,KAAuB,GAAG;AAC9BmC,MAAAA,OAAO,EAAE,IAAI,CAACtC,OAAO,CAACsC,OAAO,IAAI,CAAC;MAClCF,KAAK,EAAE,IAAI,CAACD,WAAW,CAACX,OAAO,CAAC,CAAC6C,SAAS;AAC1CC,MAAAA,YAAY,EAAE,IAAI,CAACrB,eAAe,EAAE;AACpCL,MAAAA,SAAAA;KACD,CAAA;IACD,IAAIzC,KAAK,CAACmC,OAAO,KAAK,CAAC,IAAI,IAAI,CAACtC,OAAO,CAAC0C,mBAAmB,EAAE;AAC3DvC,MAAAA,KAAK,CAACuC,mBAAmB,GAAG,IAAI,CAAC1C,OAAO,CAAC0C,mBAAmB,CAAA;AAC9D,KAAA;AACA,IAAA,OAAOlB,OAAO,CAACqC,YAAY,CAACU,MAAM,CAACpE,KAAK,CAAC,CAAA;AAC3C,GAAA;EAEA,MAAMqE,wBAAwB,CAC5BhD,OAAwD,EACxDxB,OAAqC,GAAG,EAAE,EACpB;IACtB,IAAIyE,OAA2B,GAAG,IAAI,CAAA;AACtC,IAAA,IAAI,CAAC,IAAI,CAACzE,OAAO,CAAC4C,SAAS,EAAE;MAC3B6B,OAAO,GAAG,MAAM,IAAI,CAAC3B,kBAAkB,CAACtB,OAAO,EAAExB,OAAO,CAAC,CAAA;AAC3D,KAAA;AACA,IAAA,OAAOyE,OAAO,CAACV,KAAK,CAACvC,OAAO,CAAC,CAAA;AAC/B,GAAA;EAEA,MAAMkD,YAAY,CAChBlD,OAAwD,EAClC;AACtB,IAAA,OAAOmD,eAAe,CACpB,MAAM,IAAI,CAACH,wBAAwB,CAAChD,OAAO,CAAC,EAC5C,IAAI,CAAC0B,UAAU,CAAC1B,OAAO,CAAC,CACzB,CAAA;AACH,GAAA;EAEA,MAAMoD,IAAI,CACRpD,OAAwD,EACxDxB,OAAkC,GAAG,EAAE,EACR;IAC/B,MAAM6E,WAAW,GAAG,MAAM,IAAI,CAACH,YAAY,CAAClD,OAAO,CAAC,CAAA;IACpD,OAAOA,OAAO,CAACuB,GAAG,CAAC+B,eAAe,CAACD,WAAW,EAAE7E,OAAO,CAAC,CAAA;AAC1D,GAAA;EAEA,MAAM+E,OAAO,CACXvD,OAAwD,EACxDwD,SAA+B,EAC/BhF,OAA8C,GAAG,EAAE,EACb;IACtC,IAAIyE,OAA2B,GAAG,IAAI,CAAA;AACtC,IAAA,IAAI,CAAC,IAAI,CAACzE,OAAO,CAAC4C,SAAS,EAAE;AAC3B6B,MAAAA,OAAO,GAAG,MAAM,IAAI,CAAC3B,kBAAkB,CAACtB,OAAO,CAAC,CAAA;AAClD,KAAA;AAEA,IAAA,IAAIyD,QAAuC,CAAA;IAC3C,IAAIjF,OAAO,CAACiF,QAAQ,EAAE;MACpBA,QAAQ,GAAGjF,OAAO,CAACiF,QAAQ,CAAA;AAC7B,KAAC,MAAM;MACL,MAAMrC,SAAS,GACb,OAAO6B,OAAO,CAACzE,OAAO,CAAC4C,SAAS,KAAK,QAAQ,GACzC6B,OAAO,CAACzE,OAAO,CAAC4C,SAAS,GACzB,MAAMpB,OAAO,CAACuB,GAAG,CAACC,kBAAkB,EAAE,CAAA;AAC5CiC,MAAAA,QAAQ,GAAGjF,OAAO,CAACiF,QAAQ,IAAI;AAAEC,QAAAA,IAAI,EAAE,WAAW;QAAE,GAAGtC,SAAAA;OAAW,CAAA;AACpE,KAAA;AAEA,IAAA,OAAOpB,OAAO,CAACuB,GAAG,CAACoC,kBAAkB,CAACH,SAAS,EAAE;AAAE,MAAA,GAAGhF,OAAO;AAAEiF,MAAAA,QAAAA;AAAS,KAAC,CAAC,CAAA;AAC5E,GAAA;EAEA,MAAMG,cAAc,CAClB5D,OAAwD,EACxDxB,OAAgD,GAAG,EAAE,EAIpD;IACD,IAAIyE,OAA2B,GAAG,IAAI,CAAA;AACtC,IAAA,IAAI,CAAC,IAAI,CAACzE,OAAO,CAAC4C,SAAS,EAAE;AAC3B6B,MAAAA,OAAO,GAAG,MAAM,IAAI,CAAC3B,kBAAkB,CAACtB,OAAO,CAAC,CAAA;AAClD,KAAA;AACA,IAAA,MAAMwD,SAAS,GAAG,MAAMP,OAAO,CAACG,IAAI,CAACpD,OAAO,EAAExB,OAAO,CAAC4E,IAAI,CAAC,CAAA;AAC3D,IAAA,MAAMS,MAAM,GAAG,MAAMZ,OAAO,CAACM,OAAO,CAACvD,OAAO,EAAEwD,SAAS,EAAEhF,OAAO,CAAC+E,OAAO,CAAC,CAAA;IACzE,OAAO;MAAEC,SAAS;AAAEK,MAAAA,MAAAA;KAAQ,CAAA;AAC9B,GAAA;EAEUjF,UAAU,CAClBD,KAAmC,EACb;AACtB,IAAA,OAAO,CAACgB,KAAK,CAACC,OAAO,CAACjB,KAAK,CAAC,GAAGA,KAAK,GAAG,CAACA,KAAK,CAAC,EAAEiD,OAAO,CAAEzB,IAAI,IAC3D,OAAO,IAAIA,IAAI,GAAGA,IAAI,CAAC5B,KAAK,GAAG,CAAC4B,IAAI,CAAC,CACtC,CAAA;AACH,GAAA;AACF,CAAA;;AAEA;AACA;AACA;AACA;AACa2D,MAAAA,kBAAkB,GAAG,CAACvF,KAA2B,GAAG,EAAE,KACjE,IAAIF,kBAAkB,CAACE,KAAK;;;;"}